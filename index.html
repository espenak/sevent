<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>sevent: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.3 -->
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">sevent</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<h1>sevent Documentation</h1>  </div>
</div>
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="about"></a>
About</h2>
<p>sevent (socket event) is a network-event-handling library. It has a implementation-independent interface(sevent::socket) and a boost::asio implementation (<a class="el" href="namespacesevent_1_1asiosocket.html">sevent::asiosocket</a>). On top of that it has a couple of utilities making common tasks easier:</p>
<ul>
<li><a class="el" href="namespacesevent_1_1event.html" title="sevent::socket has a single handler for all events, this namespace adds event-forwarding to multiple ...">sevent::event</a></li>
<li>sevent::boostserialize</li>
<li><a class="el" href="namespacesevent_1_1endiansafe.html">sevent::endiansafe</a></li>
</ul>
<h2><a class="anchor" id="simpleexample"></a>
Simple example</h2>
<p>For more examples, see examples/. examples/showcase/ uses most of the features in the library, like endian-safe array-transfer, and boost-serialized object transfer.</p>
<h3><a class="anchor" id="SimpleClient"></a>
SimpleClient.cc</h3>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;boost/lexical_cast.hpp&gt;</span>
<span class="preprocessor">#include &quot;<a class="code" href="sevent_8h.html">sevent/sevent.h</a>&quot;</span>
<span class="preprocessor">#include &quot;SerializablePerson.h&quot;</span>

<span class="keyword">using namespace </span>sevent;
<span class="keyword">using namespace </span>sevent::socket;
<span class="keyword">using namespace </span>sevent::event;
<span class="keyword">using namespace </span>sevent::datastruct;

<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[])
{
    <span class="keywordflow">if</span>(argc &lt; 3)
    {
        std::cout &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0]
            &lt;&lt; <span class="stringliteral">&quot; &lt;server-ip&gt; &lt;server-port&gt;&quot;</span> &lt;&lt; std::endl;
        <span class="keywordflow">return</span> 1;
    }
    std::string host(argv[1]);
    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port = boost::lexical_cast&lt;<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>&gt;(argv[2]);

    <a class="code" href="namespacesevent_1_1socket.html#ab6a9bbd05ad2c9e2961f57b48807ca54">Facade_ptr</a> facade = Facade::make();
    <a class="code" href="namespacesevent_1_1socket.html#a4785aea99362e55dfa5446b01ade44a2">Session_ptr</a> session = facade-&gt;connect(Address::make(host, port));

    <span class="comment">// Event data</span>
    <span class="keyword">typedef</span> boost::shared_ptr&lt;std::string&gt; <a class="code" href="namespacesevent_1_1serialize.html#a74d5cb202fbfea1e486b5958c53469a6">String_ptr</a>;
    String_ptr hello = boost::make_shared&lt;std::string&gt;(<span class="stringliteral">&quot;Hello&quot;</span>);
    Person_ptr superman = boost::make_shared&lt;Person&gt;(<span class="stringliteral">&quot;Superman&quot;</span>, 39);
    boost::shared_array&lt;uint32_t&gt; array = boost::shared_array&lt;uint32_t&gt;(<span class="keyword">new</span> uint32_t[3]);
    array[0] = 10;
    array[1] = 20;
    array[2] = 30;
    <a class="code" href="namespacesevent_1_1datastruct.html#a07e39d3eadc93ad3dbd21e65289f2aa8">Uint32SharedArray_ptr</a> arrayContainer = boost::make_shared&lt;Uint32SharedArray&gt;(array, 3);

    <span class="comment">// The events</span>
    <a class="code" href="namespacesevent_1_1event.html#ae28390c43d8baba3cb7d4e4730ba2e64">Event_ptr</a> helloEvent = Event::make(<span class="stringliteral">&quot;example::Msg&quot;</span>,
               Buffer::make(hello, <a class="code" href="namespacesevent_1_1serialize.html#ae52dc8b20b8a6f6696502caebab40eba">serialize::String</a>));
    <a class="code" href="namespacesevent_1_1event.html#ae28390c43d8baba3cb7d4e4730ba2e64">Event_ptr</a> supermanEvent = Event::make(<span class="stringliteral">&quot;example::Person&quot;</span>,
               Buffer::make(superman, <a class="code" href="structsevent_1_1serialize_1_1_boost.html">serialize::Boost&lt;Person&gt;</a>()));
    <a class="code" href="namespacesevent_1_1event.html#ae28390c43d8baba3cb7d4e4730ba2e64">Event_ptr</a> arrayEvent = Event::make(<span class="stringliteral">&quot;example::Array&quot;</span>,
               Buffer::make(arrayContainer, <a class="code" href="namespacesevent_1_1serialize.html#a14ea0bb36410a894071c7651c8169fe5">serialize::Uint32SharedArray</a>));

    <span class="comment">// Send the events</span>
    facade-&gt;sendEvent(session, helloEvent);
    facade-&gt;sendEvent(session, supermanEvent);
    facade-&gt;sendEvent(session, arrayEvent);
    facade-&gt;sendEvent(session, Event::make(<span class="stringliteral">&quot;example::Die&quot;</span>));
    <span class="keywordflow">return</span> 0;
}
</pre></div><h3><a class="anchor" id="SimpleServer"></a>
SimpleServer.cc</h3>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &lt;iostream&gt;</span>
<span class="preprocessor">#include &lt;boost/bind.hpp&gt;</span>
<span class="preprocessor">#include &lt;boost/lexical_cast.hpp&gt;</span>
<span class="preprocessor">#include &quot;<a class="code" href="sevent_8h.html">sevent/sevent.h</a>&quot;</span>
<span class="preprocessor">#include &quot;SerializablePerson.h&quot;</span>

<span class="keyword">using namespace </span>sevent;
<span class="keyword">using namespace </span>sevent::socket;
<span class="keyword">using namespace </span>sevent::event;
<span class="keyword">using namespace </span>sevent::datastruct;

<span class="keywordtype">void</span> helloHandler(<a class="code" href="namespacesevent_1_1socket.html#ab6a9bbd05ad2c9e2961f57b48807ca54">Facade_ptr</a> facade,
                  <a class="code" href="namespacesevent_1_1socket.html#a4785aea99362e55dfa5446b01ade44a2">Session_ptr</a> session,
                  <a class="code" href="namespacesevent_1_1event.html#ae28390c43d8baba3cb7d4e4730ba2e64">Event_ptr</a> event)
{
    <span class="keyword">typedef</span> boost::shared_ptr&lt;std::string&gt; <a class="code" href="namespacesevent_1_1serialize.html#a74d5cb202fbfea1e486b5958c53469a6">String_ptr</a>;
    String_ptr data = <span class="keyword">event</span>-&gt;first&lt;String_ptr&gt;(<a class="code" href="namespacesevent_1_1serialize.html#ae52dc8b20b8a6f6696502caebab40eba">serialize::String</a>);
    std::cout &lt;&lt; <span class="stringliteral">&quot;EventId=&quot;</span> &lt;&lt; <span class="keyword">event</span>-&gt;eventid()
        &lt;&lt; <span class="stringliteral">&quot;  Data=&quot;</span> &lt;&lt; *data &lt;&lt; std::endl;
}


<span class="keywordtype">void</span> personHandler(<a class="code" href="namespacesevent_1_1socket.html#ab6a9bbd05ad2c9e2961f57b48807ca54">Facade_ptr</a> facade,
                   <a class="code" href="namespacesevent_1_1socket.html#a4785aea99362e55dfa5446b01ade44a2">Session_ptr</a> session,
                   <a class="code" href="namespacesevent_1_1event.html#ae28390c43d8baba3cb7d4e4730ba2e64">Event_ptr</a> event)
{
    Person_ptr p = <span class="keyword">event</span>-&gt;first&lt;Person_ptr&gt;(<a class="code" href="structsevent_1_1serialize_1_1_boost.html">serialize::Boost&lt;Person&gt;</a>());
    std::cout &lt;&lt; <span class="stringliteral">&quot;Person-event received! &quot;</span>
        &lt;&lt; p-&gt;name &lt;&lt; <span class="stringliteral">&quot;:&quot;</span> &lt;&lt; p-&gt;age &lt;&lt; std::endl;
}

<span class="keywordtype">void</span> uint32ArrayHandler(<a class="code" href="namespacesevent_1_1socket.html#ab6a9bbd05ad2c9e2961f57b48807ca54">Facade_ptr</a> facade,
                        <a class="code" href="namespacesevent_1_1socket.html#a4785aea99362e55dfa5446b01ade44a2">Session_ptr</a> session,
                        <a class="code" href="namespacesevent_1_1event.html#ae28390c43d8baba3cb7d4e4730ba2e64">Event_ptr</a> event)
{
    <a class="code" href="namespacesevent_1_1datastruct.html#a07e39d3eadc93ad3dbd21e65289f2aa8">Uint32SharedArray_ptr</a> arrayContainer = <span class="keyword">event</span>-&gt;first&lt;<a class="code" href="namespacesevent_1_1datastruct.html#a07e39d3eadc93ad3dbd21e65289f2aa8">Uint32SharedArray_ptr</a>&gt;(<a class="code" href="namespacesevent_1_1datastruct.html#a01d1ff5b8637cbe435adbdf53ecd3335">serialize::Uint32SharedArray</a>);
    boost::shared_array&lt;uint32_t&gt; array = arrayContainer-&gt;array();
    std::cout &lt;&lt; <span class="stringliteral">&quot;Shared array-event received! &quot;</span> &lt;&lt; std::endl;
    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; arrayContainer-&gt;size(); i++)
    {
        std::cout &lt;&lt; <span class="stringliteral">&quot;sharedArray[&quot;</span> &lt;&lt; i &lt;&lt; <span class="stringliteral">&quot;] = &quot;</span>
            &lt;&lt; array[i] &lt;&lt; std::endl;
    }
}


<span class="keywordtype">void</span> dieHandler(<a class="code" href="namespacesevent_1_1socket.html#ab6a9bbd05ad2c9e2961f57b48807ca54">Facade_ptr</a> facade,
                <a class="code" href="namespacesevent_1_1socket.html#a4785aea99362e55dfa5446b01ade44a2">Session_ptr</a> session,
                <a class="code" href="namespacesevent_1_1event.html#ae28390c43d8baba3cb7d4e4730ba2e64">Event_ptr</a> event)
{
    std::cout &lt;&lt; <span class="stringliteral">&quot;*** DIE-event received ***&quot;</span> &lt;&lt; std::endl;
    facade-&gt;service()-&gt;stop();
}



<span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keyword">const</span> <span class="keywordtype">char</span> *argv[])
{
    <span class="keywordflow">if</span>(argc &lt; 3)
    {
        std::cout &lt;&lt; <span class="stringliteral">&quot;Usage: &quot;</span> &lt;&lt; argv[0]
            &lt;&lt; <span class="stringliteral">&quot; &lt;ip&gt; &lt;port&gt;&quot;</span> &lt;&lt; std::endl;
        <span class="keywordflow">return</span> 1;
    }
    std::string host(argv[1]);
    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> port = boost::lexical_cast&lt;<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>&gt;(argv[2]);

    <a class="code" href="namespacesevent_1_1socket.html#ab6a9bbd05ad2c9e2961f57b48807ca54">Facade_ptr</a> facade = Facade::make();

    <span class="comment">// Setup the eventhandlers</span>
    <a class="code" href="namespacesevent_1_1event.html#aa09f8f98d0dd09c8bbce46b92c310add">HandlerMap_ptr</a> eventHandlerMap = HandlerMap::make();
    eventHandlerMap-&gt;addEventHandler(<span class="stringliteral">&quot;example::Msg&quot;</span>,
                                     helloHandler);
    eventHandlerMap-&gt;addEventHandler(<span class="stringliteral">&quot;example::Person&quot;</span>,
                                     personHandler);
    eventHandlerMap-&gt;addEventHandler(<span class="stringliteral">&quot;example::Array&quot;</span>,
                                     uint32ArrayHandler);
    eventHandlerMap-&gt;addEventHandler(<span class="stringliteral">&quot;example::Die&quot;</span>,
                                     dieHandler);

    <span class="comment">// Start 5 worker threads,</span>
    <span class="comment">// and use the handler above for incoming events.</span>
    facade-&gt;setWorkerThreads(5,
            boost::bind(<a class="code" href="namespacesevent_1_1event.html#ac5f2383651f15edaa022ae55a3b87ddf" title="A &amp;quot;all events handler&amp;quot; which forwards incoming events to the handlers registered with the e...">simpleAllEventsHandler</a>,
                        eventHandlerMap,
                        _1, _2, _3));

    <span class="comment">// Create a listening socket.</span>
    <a class="code" href="namespacesevent_1_1socket.html#a33fa0eb741d461f559da788961ed2dc4">Listener_ptr</a> listener1 = facade-&gt;listen(Address::make(host, port));

    <span class="comment">// Wait for all work to finish. In this example this will happen</span>
    <span class="comment">// when the dieHandler calls facade-&gt;service()-&gt;stop().</span>
    facade-&gt;joinAllWorkerThreads();

    <span class="keywordflow">return</span> 0;
}
</pre></div><h3><a class="anchor" id="SerializablePerson"></a>
SerializablePerson.h</h3>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#pragma once</span>
<span class="preprocessor"></span><span class="preprocessor">#include &lt;boost/serialization/string.hpp&gt;</span>
<span class="preprocessor">#include &lt;boost/serialization/access.hpp&gt;</span>


<span class="keyword">class </span>Person
{
    <span class="keyword">public</span>:
        <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> age;
        std::string name;
    <span class="keyword">public</span>:
        Person() {}
        Person(<span class="keyword">const</span> std::string&amp; name_, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> age_) :
            name(name_), age(age_)
        {}

    <span class="keyword">private</span>:
        <span class="keyword">friend</span> <span class="keyword">class </span>boost::serialization::access;
        <span class="keyword">template</span>&lt;<span class="keyword">class</span> Archive&gt;
        <span class="keywordtype">void</span> serialize(Archive&amp; ar, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> version)
        {
            ar &amp; age &amp; name;
        }
};

<span class="keyword">typedef</span> boost::shared_ptr&lt;Person&gt; Person_ptr;
</pre></div> </div></div>
<hr class="footer"/><address class="footer"><small>Generated on Mon Apr 11 2011 02:13:44 for sevent by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </small></address>
</body>
</html>
